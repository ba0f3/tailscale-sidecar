apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: tailscale-webhook
  labels:
    app: tailscale-webhook
webhooks:
- name: tailscale-injector.tailscale.com
  admissionReviewVersions: ["v1", "v1beta1"]
  clientConfig:
    service:
      name: tailscale-webhook
      namespace: tailscale
      path: "/mutate"
    caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUROekNDQWgrZ0F3SUJBZ0lVR1hoT2gwRWpkekY2QVpEblB2L0NtYmxJZUdBd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0tqRW9NQ1lHQTFVRUF3d2ZkR0ZwYkhOallXeGxMWGRsWW1odmIyc3VkR0ZwYkhOallXeGxMbk4yWXpBZwpGdzB5TlRFeE1Ua3dNalE1TlROYUdBOHlNRFV6TURRd05qQXlORGsxTTFvd0tqRW9NQ1lHQTFVRUF3d2ZkR0ZwCmJITmpZV3hsTFhkbFltaHZiMnN1ZEdGcGJITmpZV3hsTG5OMll6Q0NBU0l3RFFZSktvWklodmNOQVFFQkJRQUQKZ2dFUEFEQ0NBUW9DZ2dFQkFKWUl2WUQwQWNnQklTbzBmT2cycnk4Yi9ZYUpqcHUzdmRqdVkzalVxekJRYzM3VgovNjk5OHhtSGNVRCt2YzBsVHM3SGdxYjNTT3ZLTzY2S3JUK09jYjV2ZDFYZWYwckRlL0VwN1FvenJhZThMaGtqCmNJQjlob3NJNHQyUW4wekZPZXZmWHowOXJwN1BGeGhmVTFJem1lZXpoM1gwV1YybWJDSGMxTUFyZnZLUi9xbEkKM2ZZZFdWOEZITU1MQjFYdXNrcUY1cUVraGYxOWV2N0c3SElzWk1GYUQ3WDVYaGVKa3A3M2VRSE5MQzViTWpJZAplTDdXWm1IVCtZUE0yajVGY3F4cEdsTnRRcmh2QTRUd3diNWpQYTRWY2ZDZGRsODF3S2QvNkppUWJnT1dhcXFyCnBTLzVaYTJIdWhlZStudDk3NU1mNmd1aHowak1vME9kbXg1bDNwOENBd0VBQWFOVE1GRXdIUVlEVlIwT0JCWUUKRkNzcXUrbTQrdnROeFYzaHVvaFZCOWYzUW01Mk1COEdBMVVkSXdRWU1CYUFGQ3NxdSttNCt2dE54VjNodW9oVgpCOWYzUW01Mk1BOEdBMVVkRXdFQi93UUZNQU1CQWY4d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFJNitaOGJ1CjdGeFUzVUhldUtmN08zSk1FQ0RKTWJaL2ZrMWlOL2dCMkxtdVRUYTdPZDk3a1lWZ1BCR1lLbHNCNFlMeFNDVGIKdDhXSkJkOVo1dDBVWU00cUNvT0o0Y3k4N1ZyNjg3QkxyNklCN0QwWFVlQVhWQmhZRGhFa1VRQkQ3a0pOYWJLVQpwOXhkVnZGdUpQMC9vWlcyaklBWU5qRDRYNmhVNGd6ZWcvTXdINzZLN1RWaEEySVpVOXJUeWR3Q09YNHEvRFFBCjBPSDJMU3dVNWdlaWhFZTdFY3JROFIvWVh4RllUQ2xuL3lIaU5NN1MwTEtHMThMUk5WQVVQVG1XSXhuZDZFQUEKSjlLYkpHUkswVXBxOXJ2OW54M083MDI2U29CdkpCTjY1bStNWkwxbmx6Mm9TOXdjVzg2eUttVCt2Q1daeXd6egptci9BNks5UTZFT1VWbnM9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  rules:
  - operations: ["CREATE"]
    apiGroups: [""]
    apiVersions: ["v1"]
    resources: ["pods"]
  failurePolicy: Fail
  sideEffects: None
  namespaceSelector:
    matchExpressions:
    - key: tailscale.com/inject
      operator: NotIn
      values: ["disabled"]
  objectSelector:
    matchLabels:
      tailscale.com/inject: "true"

