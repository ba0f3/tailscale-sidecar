apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: tailscale-webhook
  labels:
    app: tailscale-webhook
webhooks:
- name: tailscale-injector.tailscale.com
  admissionReviewVersions: ["v1", "v1beta1"]
  clientConfig:
    service:
      name: tailscale-webhook
      namespace: tailscale
      path: "/mutate"
    caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUROekNDQWgrZ0F3SUJBZ0lVWEoyS09aaFpCeHpIK1pRTUtyb3F5YmtzQVlRd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0tqRW9NQ1lHQTFVRUF3d2ZkR0ZwYkhOallXeGxMWGRsWW1odmIyc3VkR0ZwYkhOallXeGxMbk4yWXpBZwpGdzB5TlRFeE1Ua3dNak0wTWpOYUdBOHlNRFV6TURRd05qQXlNelF5TTFvd0tqRW9NQ1lHQTFVRUF3d2ZkR0ZwCmJITmpZV3hsTFhkbFltaHZiMnN1ZEdGcGJITmpZV3hsTG5OMll6Q0NBU0l3RFFZSktvWklodmNOQVFFQkJRQUQKZ2dFUEFEQ0NBUW9DZ2dFQkFOeWhTeVJzRFRjUnpMRitkUVVWcG5PNmZPeDhpUm1nTGhMb2VxaTUxclZBbmtFWQo0NFpuM01zbDNFTTAzYmZtYmJvVzBXOUlLbWFCd25uUVY5UWhjd05YODRwK250eWExMnFSdU5pZ2dBM1JGZDNCClRucUFUZnhmNlhVRG15NVlyS3FlcGtHUkRZcmhIS1QzaTJ1NW8xc0plRXV2bWo5YkJhTGlNOW1HWnNyZE05OUQKVytPYWN0KzNtZS9wdDVWc0srd0IzanVjNUpsN2h6ODUrNGV0UkN2QkRpRUp2UUg2aTlLSUpVM1d0Wm5wNEdLVgpWYWQxOUEzcENyTU1HOW11amNVYlN5VzUvQVpzMTlhMUhLcmpMVmlUeUYva3VwY0RrTTVOOHYwM0V5cmFrLzQrCkFmUTBxaktscmVXSEpkSERlV293b2dwTlFYVllDUjgwVzVLWE1xY0NBd0VBQWFOVE1GRXdIUVlEVlIwT0JCWUUKRk5xY1NTS2FES3M4bHhxU0RueUdwOXBFMTBFSU1COEdBMVVkSXdRWU1CYUFGTnFjU1NLYURLczhseHFTRG55RwpwOXBFMTBFSU1BOEdBMVVkRXdFQi93UUZNQU1CQWY4d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFIZHdHY04zCnZaZ2FvR0daV2tyN2d4L1ZQZDd1ZHlsTmRvTEdCZWU1c2JNZ2pSZTJ6aHJScEZFLzRBbmZBUzcyU2VZRXJmK1IKV2tGeWs5N1FjdDJ6QTFUSWg1SjVYbis1THBBb0J2UXl5Q04xOCtXeHpFMFAyOVNUZTVaeis2a1FYZ1ZoSEx0VQpvcDBZS05vOXAxTW5nd2IvVjR3STJJSUV4b2ZOb21jdVh1UTBOQmhqY1FKa0hyVTc5Sy9lTWpxM1JJLy9sMUorCnBxdmlKa3JJMVZ5aVFCTFNYU2R4YU9DRWRqYmhoVis3Y1FsSWZiU1hOQmtJWjZkcDBsYXF0Um4xRmU2QlhkRlEKUTJhTDZMYVRrL1BNRWlJMk5yd3l0bGgvcllUdXFTWVZTNXlWV1JMVitYcWJQVk9Oems2cENUaCtLSlJZbm1GWQpZNHdJSTlVdHVPV0hqeFU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  rules:
  - operations: ["CREATE"]
    apiGroups: [""]
    apiVersions: ["v1"]
    resources: ["pods"]
  failurePolicy: Fail
  sideEffects: None
  namespaceSelector:
    matchExpressions:
    - key: tailscale.com/inject
      operator: NotIn
      values: ["disabled"]
  objectSelector:
    matchLabels:
      tailscale.com/inject: "true"

